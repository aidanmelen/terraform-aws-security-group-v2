=== RUN   TestTerraformMatrixRulesExample
TestTerraformMatrixRulesExample 2022-09-25T03:49:38Z retry.go:91: terraform [init -upgrade=false]
TestTerraformMatrixRulesExample 2022-09-25T03:49:38Z logger.go:66: Running command terraform with args [init -upgrade=false]
TestTerraformMatrixRulesExample 2022-09-25T03:49:38Z logger.go:66: [0m[1mInitializing modules...[0m
TestTerraformMatrixRulesExample 2022-09-25T03:49:38Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:38Z logger.go:66: [0m[1mInitializing the backend...[0m
TestTerraformMatrixRulesExample 2022-09-25T03:49:38Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:38Z logger.go:66: [0m[1mInitializing provider plugins...[0m
TestTerraformMatrixRulesExample 2022-09-25T03:49:38Z logger.go:66: - Reusing previous version of hashicorp/aws from the dependency lock file
TestTerraformMatrixRulesExample 2022-09-25T03:49:40Z logger.go:66: - Using previously-installed hashicorp/aws v4.27.0
TestTerraformMatrixRulesExample 2022-09-25T03:49:40Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:40Z logger.go:66: [0m[1m[32mTerraform has been successfully initialized![0m[32m[0m
TestTerraformMatrixRulesExample 2022-09-25T03:49:40Z logger.go:66: [0m[32m
TestTerraformMatrixRulesExample 2022-09-25T03:49:40Z logger.go:66: You may now begin working with Terraform. Try running "terraform plan" to see
TestTerraformMatrixRulesExample 2022-09-25T03:49:40Z logger.go:66: any changes that are required for your infrastructure. All Terraform commands
TestTerraformMatrixRulesExample 2022-09-25T03:49:40Z logger.go:66: should now work.
TestTerraformMatrixRulesExample 2022-09-25T03:49:40Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:40Z logger.go:66: If you ever set or change modules or backend configuration for Terraform,
TestTerraformMatrixRulesExample 2022-09-25T03:49:40Z logger.go:66: rerun this command to reinitialize your working directory. If you forget, other
TestTerraformMatrixRulesExample 2022-09-25T03:49:40Z logger.go:66: commands will detect it and remind you to do so if necessary.[0m
TestTerraformMatrixRulesExample 2022-09-25T03:49:40Z retry.go:91: terraform [apply -input=false -auto-approve -no-color -lock=false]
TestTerraformMatrixRulesExample 2022-09-25T03:49:40Z logger.go:66: Running command terraform with args [apply -input=false -auto-approve -no-color -lock=false]
TestTerraformMatrixRulesExample 2022-09-25T03:49:43Z logger.go:66: data.aws_prefix_list.private_s3: Reading...
TestTerraformMatrixRulesExample 2022-09-25T03:49:43Z logger.go:66: data.aws_vpc.default: Reading...
TestTerraformMatrixRulesExample 2022-09-25T03:49:43Z logger.go:66: data.aws_prefix_list.private_s3: Read complete after 1s [id=pl-1111111111111111]
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66: data.aws_vpc.default: Read complete after 1s [id=vpc-1111111111111111]
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66: data.aws_security_group.default: Reading...
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66: data.aws_security_group.default: Read complete after 0s [id=sg-1111111111111111]
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66: Error: Invalid object key
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:   on ../../matrix.tf line 81, in resource "aws_security_group_rule" "matrix_ingress":
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:   80:   for_each = {
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:   81:     for rule in local.matrix_ingress : try(
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:   82:       rule.key,
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:   83:       lower(replace(replace(join("-", compact(flatten(values(rule)))), " ", "-"), "_", "-")),
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:   84:     ) => rule
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:   85:   }
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:     â”‚ rule.key is null
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66: Key expression in 'for' expression must not produce a null value.
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66: Error: Invalid object key
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:   on ../../matrix.tf line 105, in resource "aws_security_group_rule" "matrix_egress":
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:  104:   for_each = {
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:  105:     for rule in local.matrix_egress : try(
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:  106:       rule.key,
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:  107:       lower(replace(replace(join("-", compact(flatten(values(rule)))), " ", "-"), "_", "-")),
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:  108:     ) => rule
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:  109:   }
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:     â”‚ rule.key is null
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66: Key expression in 'for' expression must not produce a null value.
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z retry.go:99: Returning due to fatal error: FatalError{Underlying: error while running command: exit status 1;
Error: Invalid object key

  on ../../matrix.tf line 81, in resource "aws_security_group_rule" "matrix_ingress":
  80:   for_each = {
  81:     for rule in local.matrix_ingress : try(
  82:       rule.key,
  83:       lower(replace(replace(join("-", compact(flatten(values(rule)))), " ", "-"), "_", "-")),
  84:     ) => rule
  85:   }
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚ rule.key is null

Key expression in 'for' expression must not produce a null value.

Error: Invalid object key

  on ../../matrix.tf line 105, in resource "aws_security_group_rule" "matrix_egress":
 104:   for_each = {
 105:     for rule in local.matrix_egress : try(
 106:       rule.key,
 107:       lower(replace(replace(join("-", compact(flatten(values(rule)))), " ", "-"), "_", "-")),
 108:     ) => rule
 109:   }
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚ rule.key is null

Key expression in 'for' expression must not produce a null value.}
    apply.go:15:
        	Error Trace:	/workspaces/terraform-aws-security-group-v2/test/apply.go:15
        	            				/workspaces/terraform-aws-security-group-v2/test/terraform_matrix_test.go:25
        	Error:      	Received unexpected error:
        	            	FatalError{Underlying: error while running command: exit status 1;
        	            	Error: Invalid object key

        	            	  on ../../matrix.tf line 81, in resource "aws_security_group_rule" "matrix_ingress":
        	            	  80:   for_each = {
        	            	  81:     for rule in local.matrix_ingress : try(
        	            	  82:       rule.key,
        	            	  83:       lower(replace(replace(join("-", compact(flatten(values(rule)))), " ", "-"), "_", "-")),
        	            	  84:     ) => rule
        	            	  85:   }
        	            	    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        	            	    â”‚ rule.key is null

        	            	Key expression in 'for' expression must not produce a null value.

        	            	Error: Invalid object key

        	            	  on ../../matrix.tf line 105, in resource "aws_security_group_rule" "matrix_egress":
        	            	 104:   for_each = {
        	            	 105:     for rule in local.matrix_egress : try(
        	            	 106:       rule.key,
        	            	 107:       lower(replace(replace(join("-", compact(flatten(values(rule)))), " ", "-"), "_", "-")),
        	            	 108:     ) => rule
        	            	 109:   }
        	            	    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        	            	    â”‚ rule.key is null

        	            	Key expression in 'for' expression must not produce a null value.}
        	Test:       	TestTerraformMatrixRulesExample
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z retry.go:91: terraform [destroy -auto-approve -input=false -no-color -lock=false]
TestTerraformMatrixRulesExample 2022-09-25T03:49:44Z logger.go:66: Running command terraform with args [destroy -auto-approve -input=false -no-color -lock=false]
TestTerraformMatrixRulesExample 2022-09-25T03:49:47Z logger.go:66: data.aws_vpc.default: Reading...
TestTerraformMatrixRulesExample 2022-09-25T03:49:47Z logger.go:66: data.aws_prefix_list.private_s3: Reading...
TestTerraformMatrixRulesExample 2022-09-25T03:49:47Z logger.go:66: data.aws_prefix_list.private_s3: Read complete after 0s [id=pl-1111111111111111]
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66: data.aws_vpc.default: Read complete after 0s [id=vpc-1111111111111111]
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66: data.aws_security_group.default: Reading...
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66: data.aws_security_group.default: Read complete after 0s [id=sg-1111111111111111]
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66: Error: Invalid object key
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:   on ../../matrix.tf line 81, in resource "aws_security_group_rule" "matrix_ingress":
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:   80:   for_each = {
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:   81:     for rule in local.matrix_ingress : try(
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:   82:       rule.key,
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:   83:       lower(replace(replace(join("-", compact(flatten(values(rule)))), " ", "-"), "_", "-")),
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:   84:     ) => rule
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:   85:   }
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:     â”‚ rule.key is null
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66: Key expression in 'for' expression must not produce a null value.
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66: Error: Invalid object key
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:   on ../../matrix.tf line 105, in resource "aws_security_group_rule" "matrix_egress":
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:  104:   for_each = {
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:  105:     for rule in local.matrix_egress : try(
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:  106:       rule.key,
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:  107:       lower(replace(replace(join("-", compact(flatten(values(rule)))), " ", "-"), "_", "-")),
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:  108:     ) => rule
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:  109:   }
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:     â”‚ rule.key is null
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66:
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z logger.go:66: Key expression in 'for' expression must not produce a null value.
TestTerraformMatrixRulesExample 2022-09-25T03:49:48Z retry.go:99: Returning due to fatal error: FatalError{Underlying: error while running command: exit status 1;
Error: Invalid object key

  on ../../matrix.tf line 81, in resource "aws_security_group_rule" "matrix_ingress":
  80:   for_each = {
  81:     for rule in local.matrix_ingress : try(
  82:       rule.key,
  83:       lower(replace(replace(join("-", compact(flatten(values(rule)))), " ", "-"), "_", "-")),
  84:     ) => rule
  85:   }
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚ rule.key is null

Key expression in 'for' expression must not produce a null value.

Error: Invalid object key

  on ../../matrix.tf line 105, in resource "aws_security_group_rule" "matrix_egress":
 104:   for_each = {
 105:     for rule in local.matrix_egress : try(
 106:       rule.key,
 107:       lower(replace(replace(join("-", compact(flatten(values(rule)))), " ", "-"), "_", "-")),
 108:     ) => rule
 109:   }
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚ rule.key is null

Key expression in 'for' expression must not produce a null value.}
    destroy.go:11:
        	Error Trace:	/workspaces/terraform-aws-security-group-v2/test/destroy.go:11
        	            				/workspaces/terraform-aws-security-group-v2/test/panic.go:642
        	            				/workspaces/terraform-aws-security-group-v2/test/testing.go:756
        	            				/workspaces/terraform-aws-security-group-v2/test/apply.go:15
        	            				/workspaces/terraform-aws-security-group-v2/test/terraform_matrix_test.go:25
        	Error:      	Received unexpected error:
        	            	FatalError{Underlying: error while running command: exit status 1;
        	            	Error: Invalid object key

        	            	  on ../../matrix.tf line 81, in resource "aws_security_group_rule" "matrix_ingress":
        	            	  80:   for_each = {
        	            	  81:     for rule in local.matrix_ingress : try(
        	            	  82:       rule.key,
        	            	  83:       lower(replace(replace(join("-", compact(flatten(values(rule)))), " ", "-"), "_", "-")),
        	            	  84:     ) => rule
        	            	  85:   }
        	            	    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        	            	    â”‚ rule.key is null

        	            	Key expression in 'for' expression must not produce a null value.

        	            	Error: Invalid object key

        	            	  on ../../matrix.tf line 105, in resource "aws_security_group_rule" "matrix_egress":
        	            	 104:   for_each = {
        	            	 105:     for rule in local.matrix_egress : try(
        	            	 106:       rule.key,
        	            	 107:       lower(replace(replace(join("-", compact(flatten(values(rule)))), " ", "-"), "_", "-")),
        	            	 108:     ) => rule
        	            	 109:   }
        	            	    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        	            	    â”‚ rule.key is null

        	            	Key expression in 'for' expression must not produce a null value.}
        	Test:       	TestTerraformMatrixRulesExample
--- FAIL: TestTerraformMatrixRulesExample (10.32s)
FAIL
FAIL	command-line-arguments	10.334s
FAIL
